<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎵 婚禮互動任務 Final Demo</title>
<style>
:root {
  --font-base: 22px;
  --font-lg: 30px;
  --font-xl: 40px;
  --muted: #6b7280;
  --ink: #111827;
  --card-w: 880px;
}
body {
  margin: 0;
  font-family: 'Noto Sans TC', sans-serif;
  background: linear-gradient(180deg, rgba(247,216,104,1) 0%, rgba(209,187,144,1) 50%, rgba(184,169,169,1) 100%);
  overflow: hidden;
  color: var(--ink);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#main-area {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.main-card {
  background: rgba(255,255,255,0.9);
  border-radius: 24px;
  box-shadow: 0 0 20px rgba(255,255,255,0.5);
  text-align: center;
  width: var(--card-w);
  padding: 30px 20px;
  backdrop-filter: blur(6px);
  transition: all 0.6s ease;
}
.main-card h1 { font-size: var(--font-xl); margin: 10px 0; }
.main-card p { font-size: var(--font-base); color: var(--muted); }
button {
  background-color: #ffb703;
  border: none;
  border-radius: 10px;
  color: #111;
  font-size: var(--font-base);
  padding: 10px 25px;
  cursor: pointer;
  margin-top: 15px;
}
button:hover { background-color: #ffd166; }
#bottom-area {
  display: flex;
  height: 45%;
  border-top: 4px solid #fff;
}
#leaderboard {
  flex: 1;
  background: linear-gradient(180deg,rgba(169,169,235,1) 0%, rgba(158,224,255,1) 77%, rgba(0,212,255,1) 100%);
  padding: 10px 20px;
  overflow-y: auto;
}
#leaderboard h2 {
  text-align: center;
  font-size: var(--font-lg);
  color: #111;
  margin: 5px 0 10px;
}
table { width: 100%; border-collapse: collapse; font-size: 18px; color: #111; }
th, td { text-align: center; padding: 6px; }
th { background-color: rgba(255,255,255,0.4); }
tr:nth-child(even) { background-color: rgba(255,255,255,0.2); }
.ellipsis td { text-align: center; color: #555; font-style: italic; }
#map { flex: 1; height: 100%; border-left: 4px solid #fff; position: relative; overflow: hidden; }
.leaflet-container { width: 100%; height: 100%; background: #f5f5f5; }

/* 🛎️ 通知浮窗 */
#notif {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(255,255,255,0.9);
  border-radius: 12px;
  padding: 10px 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  font-size: 18px;
  color: #111;
  opacity: 0;
  transition: all .4s ease;
  pointer-events: none;
}
#notif.show { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>
<div id="app">
  <div id="main-area">
    <div class="main-card" id="mission-card">
      <h1>🎵 婚禮互動任務</h1>
      <p>歡迎參加婚禮任務活動～<br>請點擊開始進行挑戰！</p>
      <button onclick="nextMission()">開始任務 ▶</button>
    </div>
  </div>
  <div id="bottom-area">
    <div id="leaderboard">
      <h2>🏆 排行榜</h2>
      <table>
        <thead><tr><th>名次</th><th>暱稱</th><th>分數</th></tr></thead>
        <tbody id="rank-body"></tbody>
      </table>
    </div>
    <div id="map"></div>
  </div>
</div>
<div id="notif"></div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// 🏁 任務流程
let step = 0;
const missions = [
  "1️⃣ 簽到：請完成簽到並輸入暱稱！",
  "2️⃣ 簽名：請上傳您的簽名或照片！",
  "3️⃣ 找招待：請找到現場工作人員確認～",
  "4️⃣ 找新人拍照：與新人合照一張 📸",
  "5️⃣ 相本桌拼圖：完成小遊戲獲得分數～",
  "6️⃣ 四選一：回答婚禮小測驗 💡"
];
function nextMission() {
  const card = document.getElementById("mission-card");
  if (step < missions.length) {
    card.innerHTML = `<h1>🎯 第 ${step+1} 關</h1><p>${missions[step]}</p><button onclick="nextMission()">下一關 ▶</button>`;
    step++;
  } else {
    card.innerHTML = `<h1>🎉 恭喜完成所有任務！</h1><p>感謝參與婚禮互動～</p>`;
  }
}

// 🏆 排行榜 + 通知
let players = [
  {name: "變態人林阿軒", score: 100},
  {name: "Alice", score: 95},
  {name: "Bob", score: 90},
  {name: "張咩揚", score: 85},
  {name: "沒在睡的王曉慧", score: 80},
  {name: "Eve", score: 75},
  {name: "Frank", score: 70},
  {name: "Grace", score: 65},
  {name: "Heidi", score: 60},
  {name: "Ivan", score: 55}
];
let lastRanks = {};

function showNotif(text, type) {
  const n = document.getElementById('notif');
  n.innerHTML = text;
  n.style.background = type==='up' ? '#d1ffd1' : '#ffe6e6';
  n.classList.add('show');
  setTimeout(()=>n.classList.remove('show'), 3000);
}

function renderLeaderboard() {
  players.sort((a, b) => b.score - a.score);
  const tbody = document.getElementById("rank-body");
  tbody.innerHTML = "";

  players.forEach((p, i) => {
    const prev = lastRanks[p.name];
    if (prev !== undefined && prev !== i) {
      if (prev > i) showNotif(`⬆️ ${p.name} 上升至第 ${i+1} 名！🎉`, 'up');
      else showNotif(`⬇️ ${p.name} 下降至第 ${i+1} 名～😅`, 'down');
    }
    lastRanks[p.name] = i;
  });

  players.slice(0, 5).forEach((p, i) => {
    const medal = i===0?"🥇":i===1?"🥈":i===2?"🥉":i+1;
    tbody.innerHTML += `<tr><td>${medal}</td><td>${p.name}</td><td>${p.score}</td></tr>`;
  });
  tbody.innerHTML += "<tr class='ellipsis'><td colspan='3'>...</td></tr>";
  players.slice(-3).forEach((p,i)=>{
    tbody.innerHTML += `<tr><td>${players.length-2+i}</td><td>${p.name}</td><td>${p.score}</td></tr>`;
  });
}

setInterval(()=>{
  const randomPlayer = players[Math.floor(Math.random()*players.length)];
  randomPlayer.score += Math.floor(Math.random()*7-3);
  if(randomPlayer.score<0) randomPlayer.score=0;
  renderLeaderboard();
},2000);

renderLeaderboard();

// 🗺️ Leaflet Map 放大比例 + 保持原始比例
const map = L.map('map', { crs: L.CRS.Simple, minZoom: -1, maxZoom: 3, attributionControl: false });
const imageUrl = 'assets/WL-平面場圖-4.png';
const img = new Image();
img.src = imageUrl;
img.onload = function() {
  const w = img.width, h = img.height;
  const bounds = [[0,0],[h,w]];
  L.imageOverlay(imageUrl, bounds).addTo(map);
  map.fitBounds(bounds);
  map.setMaxBounds(bounds);

  // 🩵 改成略微放大（+0.2）→ 比例更自然
  map.setZoom(map.getZoom() + 0.2);

  // 💍 浮水印
  L.control.attribution({prefix: false})
    .addAttribution('💍 MYs Map © 2025-10')
    .addTo(map);

  const points = [
    { name: "關卡一", coords: [h*0.45, w*0.45], color: "red" },
    { name: "關卡二", coords: [h*0.35, w*0.7], color: "red" },
    { name: "關卡三", coords: [h*0.55, w*0.3], color: "red" },
    { name: "關卡四", coords: [h*0.25, w*0.8], color: "red" },
    { name: "關卡五", coords: [h*0.2,  w*0.2], color: "red" },
    { name: "關卡六", coords: [h*0.4,  w*0.1], color: "red" },
    { name: "🎁 Bonus A", coords: [h*0.55, w*0.65], color: "gold" },
    { name: "🎁 Bonus B", coords: [h*0.4,  w*0.6], color: "gold" },
    { name: "🎁 Bonus C", coords: [h*0.75, w*0.5], color: "gold" }
  ];
  points.forEach(p => {
    L.circleMarker(p.coords, {
      radius: 4,
      color: p.color,
      fillColor: p.color,
      fillOpacity: 0.9
    }).addTo(map).bindTooltip(p.name, { direction: 'top', offset: [0,-4] });
  });
};
</script>
</body>
</html>

