<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸµ å©šç¦®äº’å‹•ä»»å‹™ Final Demo</title>
<style>
:root {
  --font-base: 22px;
  --font-lg: 30px;
  --font-xl: 40px;
  --muted: #6b7280;
  --ink: #111827;
  --card-w: 880px;
}
body {
  margin: 0;
  font-family: 'Noto Sans TC', sans-serif;
  background: linear-gradient(180deg, rgba(247,216,104,1) 0%, rgba(209,187,144,1) 50%, rgba(184,169,169,1) 100%);
  overflow: hidden;
  color: var(--ink);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#main-area {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.main-card {
  background: rgba(255,255,255,0.9);
  border-radius: 24px;
  box-shadow: 0 0 20px rgba(255,255,255,0.5);
  text-align: center;
  width: var(--card-w);
  padding: 30px 20px;
  backdrop-filter: blur(6px);
  transition: all 0.6s ease;
}
.main-card h1 { font-size: var(--font-xl); margin: 10px 0; }
.main-card p { font-size: var(--font-base); color: var(--muted); }
button {
  background-color: #ffb703;
  border: none;
  border-radius: 10px;
  color: #111;
  font-size: var(--font-base);
  padding: 10px 25px;
  cursor: pointer;
  margin-top: 15px;
}
button:hover { background-color: #ffd166; }
#bottom-area {
  display: flex;
  height: 45%;
  border-top: 4px solid #fff;
}
#leaderboard {
  flex: 1;
  background: linear-gradient(180deg,rgba(169,169,235,1) 0%, rgba(158,224,255,1) 77%, rgba(0,212,255,1) 100%);
  padding: 10px 20px;
  overflow-y: auto;
}
#leaderboard h2 {
  text-align: center;
  font-size: var(--font-lg);
  color: #111;
  margin: 5px 0 10px;
}
table { width: 100%; border-collapse: collapse; font-size: 18px; color: #111; }
th, td { text-align: center; padding: 6px; }
th { background-color: rgba(255,255,255,0.4); }
tr:nth-child(even) { background-color: rgba(255,255,255,0.2); }
.ellipsis td { text-align: center; color: #555; font-style: italic; }
#map { flex: 1; height: 100%; border-left: 4px solid #fff; position: relative; overflow: hidden; }
.leaflet-container { width: 100%; height: 100%; background: #f5f5f5; }

/* ğŸ›ï¸ é€šçŸ¥æµ®çª— */
#notif {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(255,255,255,0.9);
  border-radius: 12px;
  padding: 10px 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  font-size: 18px;
  color: #111;
  opacity: 0;
  transition: all .4s ease;
  pointer-events: none;
}
#notif.show { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>
<div id="app">
  <div id="main-area">
    <div class="main-card" id="mission-card">
      <h1>ğŸµ å©šç¦®äº’å‹•ä»»å‹™</h1>
      <p>æ­¡è¿åƒåŠ å©šç¦®ä»»å‹™æ´»å‹•ï½<br>è«‹é»æ“Šé–‹å§‹é€²è¡ŒæŒ‘æˆ°ï¼</p>
      <button onclick="nextMission()">é–‹å§‹ä»»å‹™ â–¶</button>
    </div>
  </div>
  <div id="bottom-area">
    <div id="leaderboard">
      <h2>ğŸ† æ’è¡Œæ¦œ</h2>
      <table>
        <thead><tr><th>åæ¬¡</th><th>æš±ç¨±</th><th>åˆ†æ•¸</th></tr></thead>
        <tbody id="rank-body"></tbody>
      </table>
    </div>
    <div id="map"></div>
  </div>
</div>
<div id="notif"></div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ğŸ ä»»å‹™æµç¨‹
let step = 0;
const missions = [
  "1ï¸âƒ£ ç°½åˆ°ï¼šè«‹å®Œæˆç°½åˆ°ä¸¦è¼¸å…¥æš±ç¨±ï¼",
  "2ï¸âƒ£ ç°½åï¼šè«‹ä¸Šå‚³æ‚¨çš„ç°½åæˆ–ç…§ç‰‡ï¼",
  "3ï¸âƒ£ æ‰¾æ‹›å¾…ï¼šè«‹æ‰¾åˆ°ç¾å ´å·¥ä½œäººå“¡ç¢ºèªï½",
  "4ï¸âƒ£ æ‰¾æ–°äººæ‹ç…§ï¼šèˆ‡æ–°äººåˆç…§ä¸€å¼µ ğŸ“¸",
  "5ï¸âƒ£ ç›¸æœ¬æ¡Œæ‹¼åœ–ï¼šå®Œæˆå°éŠæˆ²ç²å¾—åˆ†æ•¸ï½",
  "6ï¸âƒ£ å››é¸ä¸€ï¼šå›ç­”å©šç¦®å°æ¸¬é©— ğŸ’¡"
];
function nextMission() {
  const card = document.getElementById("mission-card");
  if (step < missions.length) {
    card.innerHTML = `<h1>ğŸ¯ ç¬¬ ${step+1} é—œ</h1><p>${missions[step]}</p><button onclick="nextMission()">ä¸‹ä¸€é—œ â–¶</button>`;
    step++;
  } else {
    card.innerHTML = `<h1>ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰ä»»å‹™ï¼</h1><p>æ„Ÿè¬åƒèˆ‡å©šç¦®äº’å‹•ï½</p>`;
  }
}

// ğŸ† æ’è¡Œæ¦œ + é€šçŸ¥
let players = [
  {name: "è®Šæ…‹äººæ—é˜¿è»’", score: 100},
  {name: "Alice", score: 95},
  {name: "Bob", score: 90},
  {name: "å¼µå’©æš", score: 85},
  {name: "æ²’åœ¨ç¡çš„ç‹æ›‰æ…§", score: 80},
  {name: "Eve", score: 75},
  {name: "Frank", score: 70},
  {name: "Grace", score: 65},
  {name: "Heidi", score: 60},
  {name: "Ivan", score: 55}
];
let lastRanks = {};

function showNotif(text, type) {
  const n = document.getElementById('notif');
  n.innerHTML = text;
  n.style.background = type==='up' ? '#d1ffd1' : '#ffe6e6';
  n.classList.add('show');
  setTimeout(()=>n.classList.remove('show'), 3000);
}

function renderLeaderboard() {
  players.sort((a, b) => b.score - a.score);
  const tbody = document.getElementById("rank-body");
  tbody.innerHTML = "";

  players.forEach((p, i) => {
    const prev = lastRanks[p.name];
    if (prev !== undefined && prev !== i) {
      if (prev > i) showNotif(`â¬†ï¸ ${p.name} ä¸Šå‡è‡³ç¬¬ ${i+1} åï¼ğŸ‰`, 'up');
      else showNotif(`â¬‡ï¸ ${p.name} ä¸‹é™è‡³ç¬¬ ${i+1} åï½ğŸ˜…`, 'down');
    }
    lastRanks[p.name] = i;
  });

  players.slice(0, 5).forEach((p, i) => {
    const medal = i===0?"ğŸ¥‡":i===1?"ğŸ¥ˆ":i===2?"ğŸ¥‰":i+1;
    tbody.innerHTML += `<tr><td>${medal}</td><td>${p.name}</td><td>${p.score}</td></tr>`;
  });
  tbody.innerHTML += "<tr class='ellipsis'><td colspan='3'>...</td></tr>";
  players.slice(-3).forEach((p,i)=>{
    tbody.innerHTML += `<tr><td>${players.length-2+i}</td><td>${p.name}</td><td>${p.score}</td></tr>`;
  });
}

setInterval(()=>{
  const randomPlayer = players[Math.floor(Math.random()*players.length)];
  randomPlayer.score += Math.floor(Math.random()*7-3);
  if(randomPlayer.score<0) randomPlayer.score=0;
  renderLeaderboard();
},2000);

renderLeaderboard();

// ğŸ—ºï¸ Leaflet Map æ”¾å¤§æ¯”ä¾‹ + ä¿æŒåŸå§‹æ¯”ä¾‹
const map = L.map('map', { crs: L.CRS.Simple, minZoom: -1, maxZoom: 3, attributionControl: false });
const imageUrl = 'assets/WL-å¹³é¢å ´åœ–-4.png';
const img = new Image();
img.src = imageUrl;
img.onload = function() {
  const w = img.width, h = img.height;
  const bounds = [[0,0],[h,w]];
  L.imageOverlay(imageUrl, bounds).addTo(map);
  map.fitBounds(bounds);
  map.setMaxBounds(bounds);

  // ğŸ©µ æ”¹æˆç•¥å¾®æ”¾å¤§ï¼ˆ+0.2ï¼‰â†’ æ¯”ä¾‹æ›´è‡ªç„¶
  map.setZoom(map.getZoom() + 0.2);

  // ğŸ’ æµ®æ°´å°
  L.control.attribution({prefix: false})
    .addAttribution('ğŸ’ MYs Map Â© 2025-10')
    .addTo(map);

  const points = [
    { name: "é—œå¡ä¸€", coords: [h*0.45, w*0.45], color: "red" },
    { name: "é—œå¡äºŒ", coords: [h*0.35, w*0.7], color: "red" },
    { name: "é—œå¡ä¸‰", coords: [h*0.55, w*0.3], color: "red" },
    { name: "é—œå¡å››", coords: [h*0.25, w*0.8], color: "red" },
    { name: "é—œå¡äº”", coords: [h*0.2,  w*0.2], color: "red" },
    { name: "é—œå¡å…­", coords: [h*0.4,  w*0.1], color: "red" },
    { name: "ğŸ Bonus A", coords: [h*0.55, w*0.65], color: "gold" },
    { name: "ğŸ Bonus B", coords: [h*0.4,  w*0.6], color: "gold" },
    { name: "ğŸ Bonus C", coords: [h*0.75, w*0.5], color: "gold" }
  ];
  points.forEach(p => {
    L.circleMarker(p.coords, {
      radius: 4,
      color: p.color,
      fillColor: p.color,
      fillOpacity: 0.9
    }).addTo(map).bindTooltip(p.name, { direction: 'top', offset: [0,-4] });
  });
};
</script>
</body>
</html>

